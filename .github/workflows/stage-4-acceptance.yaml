name: Acceptance stage

on:
  workflow_call:
    inputs:
      pr_number:
        required: true
        type: string

permissions:
  id-token: write
  contents: read

jobs:
  acceptance-tests:
    name: Acceptance tests
    # Calls out to the nhs-notify-internal repo.
    # The nhs-notify-internal repo will run the tests
    # setup in ./.github/actions/acceptance-tests/action.yaml
    uses: ./.github/workflows/dispatch_internal_repo_workflow.yaml
    secrets: inherit
    with:
      jobName: Acceptance tests
      infraRepoName: nhs-notify-sms-nudge
      releaseVersion: ${{ github.head_ref || github.ref_name }}
      targetWorkflow: dispatch-contextual-tests-dynamic-env.yaml
      targetEnvironment: pr${{ inputs.pr_number }}
      targetAccountGroup: nhs-notify-smsnudge-dev
      targetComponent: nudge
